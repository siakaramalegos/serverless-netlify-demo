---
layout: layout.njk
---

<header>
  <div class="img-circle"><img src="/images/birthday-cake.svg" alt="birthday cake"></div>

  <div>
    <h1>Astronomy Picture of Your Birthday</h1>
    <p>NASA's <a href="https://apod.nasa.gov/apod/astropix.html">Astronomy Picture of the Day (APOD) website</a> is cool but what would be even cooler is if we could see all the APOD's for our birthdays. Enter this fine website... APOYB. You're welcome.
    </p>
  </div>

</header>

<form id="birthday-form">
  <label for="date">Your Birthday</label><br>
  <input type="date" name="date" id="date-input" required>

  <p>
    <button>Get my APOYBs</button>
  </p>
</form>

<section id="apods"></section>

<template class="apod-template">
  <article class="apod">
    <div><img src="" alt=""></div>
    <div class="videoWrapper hidden">
      <iframe width="560" height="315" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
    </div>
    <div class="apod-text">
      <p class="date"></p>
      <h2></h2>
      <p class="explanation"></p>
      <small class="hidden">&copy; <span class="copyright"></span></small>
    </div>
  </article>
</template>

<script>
  function render(values) {
    const target = document.querySelector("#apods");
    target.innerHTML = ""
    const template = document.querySelector(".apod-template");

    values.forEach(element => {
      const clone = template.content.cloneNode(true);
      const img = clone.querySelector("img")
      clone.querySelector("h2").innerText = element.title
      clone.querySelector(".date").innerText = element.date
      clone.querySelector(".explanation").innerText = element.explanation

      switch (element.media_type) {
        case "image":
          img.src = element.url
          break;
        case "video":
          clone.querySelector("iframe").src = element.url.split("youtube").join("youtube-nocookie")
          clone.querySelector(".videoWrapper").classList.remove("hidden")
          img.classList.add("hidden")
          break;
        default:
          break;
      }

      if (element.copyright) {
        clone.querySelector(".copyright").innerText = element.copyright
        clone.querySelector("small").classList.remove("hidden")
      }

      apods.appendChild(clone);
    });
  }

  async function handleSubmit(e) {
    e.preventDefault()

    const formData = new FormData(e.target)
    const date = formData.get("date")

    fetch('/.netlify/functions/apod', {
      method: "POST",
      body: JSON.stringify({date})
    })
      .then(response => {
        if (!response.ok) {
          throw new Error("Network response was not ok")
        }
        return response.json()
      })
      .then(data => {
        console.log(data)
        render(data)
      })
      .catch(error => console.error(error))
  }

  document.querySelector("#birthday-form").addEventListener("submit", handleSubmit)
</script>
